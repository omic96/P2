<!DOCTYPE html>
<html>

<head>
    <title>Rate These Movies</title>
    <meta charset="UTF-8">
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" type="text/css" href="css/mainStyleSheet.css">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

</head>

<body>
    
    <div id="movie" class="movie_div">
        
        <div id="image_div" class="image_div">
            <center>
                <h2 id="headline" class="genres_text">Titel</h2>
            </center>
            <img class="image_div" src="https://inges-kattehjem.dk/wp-content/uploads/2019/12/kattensomvoksen-1024x768.jpg" id="poster_img">

            <br><br>
            <div class="rating" style="position:relative; top: 0%;left: 20%;">
                <input type="radio" name="star">
                <label onclick="rate_movie('5')"></label>
                <input type="radio" name="star">
                <label onclick="rate_movie('4')"></label>
                <input type="radio" name="star">
                <label onclick="rate_movie('3')" ></label>
                <input type="radio" name="star">
                <label onclick="rate_movie('2')"></label>
                <input type="radio" name="star">
                <label onclick="rate_movie('1')"></label>
            </div>
            <center>
                <input type="button" value="Det lort har jeg ik set, okæ" onclick="dont_know_rating()">
    
            </center>
        </div>
        

         
      
    </div>

    <script>

        let socket = io();
        socket.emit("get movielist");

        let all_movies;
        let all_rated_moives = [];
        let curr_movie = 0;
        let rated_movies = 0;
        
        socket.on("send movielist", function(movielist) {
            console.log(movielist);
            all_movies = movielist;
            insert_movie(curr_movie);
            //rate_movie(movielist);
        });

        console.log(read_cookie("id"));

        function dont_know_rating () {
            curr_movie++;
            insert_movie(curr_movie);
        }

        function rate_movie(rating) {
            all_movies[curr_movie].rating = rating;
            all_rated_moives.push(all_movies[curr_movie]);
            curr_movie++;
            rated_movies++;
            if(rated_movies != 10) {
                insert_movie(curr_movie);
            }else{
                socket.emit("send rated movies", all_rated_moives, read_cookie("id"));
                location.href="frontpage.html";
            }
        }

        function rate_movie2(movies_to_rate){
            let rating = 0; 
            
            for (let index = 0; index < movies_to_rate.length; index++) {
                console.log(movies_to_rate[index].title);
                //movies_to_rate[index].rating 
                rating = prompt("Rate "+ movies_to_rate[index].title + " from 1-5");  //tilføjer rating til objekterne 

                //input control 
                while(isNaN(rating) || rating > 5 || rating < 1){
                        rating = prompt(rating + " is not between 1-5. Please try to rate "+ movies_to_rate[index].title + " from 1-5");
                    }
                
                    movies_to_rate[index].rating = rating;
            }
        }

        function insert_movie(movie_index) {
            document.getElementById("headline").innerHTML = all_movies[movie_index].title;
            document.getElementById("poster_img").src = all_movies[movie_index].image;
            console.log(all_movies[movie_index]);
        }

        function read_cookie(name) {
            let value = "; " + document.cookie;
            let parts = value.split("; " + name + "=");
            if (parts.length == 2) return parts.pop().split(";").shift(); 
        }
    </script>
</body>
</html>