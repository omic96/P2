<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="css/mainStyleSheet.css">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="/socket.io/socket.io.js"></script>
</head>


<body style="margin: 0;">
	<center>
		<h1 id="welcome_text" class="genres_text"></h1>
	</center>

	<div id="background" class="background">

	</div>

	<div class="rating">
	
	</div>
	

	<script>
		let socket = io();

		let my_user;

		//Loads array of all movies when the server is on, 
		let all_movies = [];
		socket.on("send_movie_array", function(data) {
			all_movies = data;
		});

		socket.emit("get data", read_cookie("id"));

		socket.on("send data", function(user_data) {
			my_user = user_data;
			document.getElementById("welcome_text").innerHTML = "Velkommen " + user_data.name;
			personalize_page();
		});

		//puts movies with the correct genre under der correct header, uses data array function to find specific genre
	
	 //function that creates our movie thumbnail and adds a overlay on mouse hover that shoves movie name and star rating feature.
	function create_elements(main_element, i) {
		
				let action_section = document.getElementById(main_element);
				
				let movie_container = document.createElement("div");
				let movie_image = document.createElement("img");
				let movie_overlay = document.createElement("div");
				let movie_title_text = document.createElement("div");
				let movie_MovieId = document.createElement("div");
				let star_ratings = document.createElement("div");

				//loop that creates clickable rating-stars under each movie overlay (used in conjunction with star_label)
				for(let j = 1; j < 6; j++) {
					let star_input = document.createElement("input");
					star_input.type = "radio";
					star_input.name = "star";
					star_input.id = "star" + j;
					
					//loop that gives correct rating value for each star 
					for(let k = 5; k >= 1; k--) {
						star_input.value = k - j + 5;
						//all_movies[i].rating = star_input.value;
					}

					//registers the users vote based on the amount of stars given and saves them in rating document file.
					let star_label = document.createElement("label");
					star_label.onclick = function(){
						console.log(all_movies[i].title);
						console.log(all_movies[i].movieId);
						console.log(star_input.value);
						//console.log(all_movies[i].rating);
						socket.emit("et eller andet", all_movies[i], read_cookie("id"), star_input.value);
					};

					star_ratings.appendChild(star_input);
					star_ratings.appendChild(star_label);
				}

				//
				action_section.appendChild(movie_container);
				movie_container.appendChild(movie_overlay);
				movie_container.appendChild(movie_image);
				movie_overlay.appendChild(movie_title_text);
				movie_overlay.appendChild(star_ratings);
				movie_overlay.appendChild(movie_MovieId);

				//assigns names under each class.
				movie_container.className = "movie_container";
				movie_overlay.className = "movie_overlay";
				movie_title_text.className = "movie_title_text";
				movie_image.className = "movie_images";
				movie_MovieId.className = "id";
				star_ratings.className = "rating";
				

				movie_title_text.innerHTML = all_movies[i].title;
				movie_MovieId.innerHTML = all_movies[i].movieId;

				//ensures that if a movie has no thumbnail is given a placeholder 
				if(all_movies[i].poster_img != "https://image.tmdb.org/t/p/w600_and_h900_bestv2null") {
				movie_image.src = all_movies[i].poster_img;
				}else{
				movie_image.src = "https://media.discordapp.net/attachments/691973400683479060/692022667477385287/no-image-available-icon-flat-260nw-1240855801.png";
				}
	}	

	function read_cookie(name) {
            var value = "; " + document.cookie;
            var parts = value.split("; " + name + "=");
            if (parts.length == 2) return parts.pop().split(";").shift();
		}
		
	function personalize_page () {
		create_category_divs(1);
		create_category_divs(0);

		for(let i = 0; i < all_movies.length; i++) {
			if(all_movies[i].genres.includes("Action")) {
				create_elements("Action", i);
			}

			if(all_movies[i].genres.includes("Romance")) {
				create_elements("Romance", i);
			}

			if(all_movies[i].genres.includes("Comedy")) {
				create_elements("Comedy", i);
			}

			if(all_movies[i].genres.includes("Horror")) {
				create_elements("Horror", i);
			}
		} 
	}

	function create_category_divs(liked_or_not) {
		for(let i = 0; i < my_user.liked_genres.length; i++) {
			if(my_user.liked_genres[i].liked === liked_or_not) {
				let main_div = document.createElement("div");
				let headline = document.createElement("h2");
				let sub_div = document.createElement("div");

				document.getElementById("background").appendChild(main_div);
				main_div.appendChild(headline);
				main_div.appendChild(sub_div);

				headline.className = "genres_text";
				sub_div.className = "movie_section";

				sub_div.id = my_user.liked_genres[i].name;

				headline.innerHTML = my_user.liked_genres[i].name;
			}
		}
	}

	</script>

</body>

</html>